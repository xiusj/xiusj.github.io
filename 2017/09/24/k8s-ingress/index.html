<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><meta name="google-site-verification" content="K7thEgdLm0UfRWJ5MGdF7sCcjClSzAlxFLPv2Oz5CGM"><title> kubernetes ingress部署 · Just Go</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="kubernetes ingress部署 - Just Go"><meta name="keywords"><meta name="author" content="Just Go"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Just Go"></head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="/images/logo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="博文" class="nav-list-link">博文</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/categories/live/" target="_self" data-hover="生活" class="nav-list-link">生活</a></li><li class="nav-list-item"><a href="/categories/film/" target="_self" data-hover="摄影" class="nav-list-link">摄影</a></li><li class="nav-list-item"><a href="/about/" target="_self" data-hover="关于" class="nav-list-link">关于</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">kubernetes ingress部署</h1><div class="post-info">2017-09-24<p class="visit"><i data-hk-page="current">-</i><span>次访问</span></p></div><div class="post-content"><h2 id="inrgess最新版部署（1-6-2-1-6-3-1-6-4）亲测成功"><a href="#inrgess最新版部署（1-6-2-1-6-3-1-6-4）亲测成功" class="headerlink" title="inrgess最新版部署（1.6.2 1.6.3 1.6.4）亲测成功"></a>inrgess最新版部署（1.6.2 1.6.3 1.6.4）亲测成功</h2><h4 id="default-backend"><a href="#default-backend" class="headerlink" title="default-backend:"></a>default-backend:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">apiVersion: extensions/v1beta1</div><div class="line">kind: Deployment</div><div class="line">metadata:</div><div class="line">  name: default-http-backend</div><div class="line">  labels:</div><div class="line">    k8s-app: default-http-backend</div><div class="line">  namespace: kube-system</div><div class="line">spec:</div><div class="line">  replicas: 1</div><div class="line">  template:</div><div class="line">    metadata:</div><div class="line">      labels:</div><div class="line">        k8s-app: default-http-backend</div><div class="line">    spec:</div><div class="line">      terminationGracePeriodSeconds: 60</div><div class="line">      containers:</div><div class="line">      - name: default-http-backend</div><div class="line">        # Any image is permissable as long as:</div><div class="line">        # 1. It serves a 404 page at /</div><div class="line">        # 2. It serves 200 on a /healthz endpoint</div><div class="line">        image: gcr.io/google_containers/defaultbackend:1.0</div><div class="line">        livenessProbe:</div><div class="line">          httpGet:</div><div class="line">            path: /healthz</div><div class="line">            port: 8080</div><div class="line">            scheme: HTTP</div><div class="line">          initialDelaySeconds: 30</div><div class="line">          timeoutSeconds: 5</div><div class="line">        ports:</div><div class="line">        - containerPort: 8080</div><div class="line">        resources:</div><div class="line">          limits:</div><div class="line">            cpu: 10m</div><div class="line">            memory: 20Mi</div><div class="line">          requests:</div><div class="line">            cpu: 10m</div><div class="line">            memory: 20Mi</div><div class="line">---</div><div class="line">apiVersion: v1</div><div class="line">kind: Service</div><div class="line">metadata:</div><div class="line">  name: default-http-backend</div><div class="line">  namespace: kube-system</div><div class="line">  labels:</div><div class="line">    k8s-app: default-http-backend</div><div class="line">spec:</div><div class="line">  ports:</div><div class="line">  - port: 80</div><div class="line">    targetPort: 8080</div><div class="line">  selector:</div><div class="line">    k8s-app: default-http-backend</div></pre></td></tr></table></figure>
<hr>
<h4 id="controller"><a href="#controller" class="headerlink" title="controller:"></a>controller:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line">apiVersion: v1</div><div class="line">kind: ServiceAccount</div><div class="line">metadata:</div><div class="line">  name: ingress</div><div class="line">  namespace: kube-system</div><div class="line">---</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1beta1</div><div class="line">kind: ClusterRole</div><div class="line">metadata:</div><div class="line">  name: system:ingress</div><div class="line">rules:</div><div class="line">- apiGroups:</div><div class="line">  - &quot;&quot;</div><div class="line">  resources: [&quot;configmaps&quot;,&quot;secrets&quot;,&quot;endpoints&quot;,&quot;events&quot;,&quot;services&quot;]</div><div class="line">  verbs: [&quot;list&quot;,&quot;watch&quot;,&quot;create&quot;,&quot;update&quot;,&quot;delete&quot;,&quot;get&quot;]</div><div class="line">- apiGroups:</div><div class="line">  - &quot;&quot;</div><div class="line">  - &quot;extensions&quot;</div><div class="line">  resources: [&quot;services&quot;,&quot;nodes&quot;,&quot;ingresses&quot;,&quot;pods&quot;,&quot;ingresses/status&quot;]</div><div class="line">  verbs: [&quot;list&quot;,&quot;watch&quot;,&quot;create&quot;,&quot;update&quot;,&quot;delete&quot;,&quot;get&quot;]</div><div class="line">---</div><div class="line">apiVersion: rbac.authorization.k8s.io/v1beta1</div><div class="line">kind: ClusterRoleBinding</div><div class="line">metadata:</div><div class="line">  name: ingress</div><div class="line">roleRef:</div><div class="line">  apiGroup: rbac.authorization.k8s.io</div><div class="line">  kind: ClusterRole</div><div class="line">  name: system:ingress</div><div class="line">subjects:</div><div class="line">  - kind: ServiceAccount</div><div class="line">    name: ingress</div><div class="line">    namespace: kube-system</div><div class="line"></div><div class="line">---</div><div class="line">apiVersion: extensions/v1beta1</div><div class="line">kind: Deployment</div><div class="line">metadata:</div><div class="line">  name: nginx-ingress-controller</div><div class="line">  labels:</div><div class="line">    k8s-app: nginx-ingress-controller</div><div class="line">  namespace: kube-system</div><div class="line">spec:</div><div class="line">  replicas: 1</div><div class="line">  template:</div><div class="line">    metadata:</div><div class="line">      labels:</div><div class="line">        k8s-app: nginx-ingress-controller</div><div class="line">      annotations:</div><div class="line">        prometheus.io/port: &apos;10254&apos;</div><div class="line">        prometheus.io/scrape: &apos;true&apos;</div><div class="line">    spec:</div><div class="line">      # hostNetwork makes it possible to use ipv6 and to preserve the source IP correctly regardless of docker configuration</div><div class="line">      # however, it is not a hard dependency of the nginx-ingress-controller itself and it may cause issues if port 10254 already is taken on the host</div><div class="line">      # that said, since hostPort is broken on CNI (https://github.com/kubernetes/kubernetes/issues/31307) we have to use hostNetwork where CNI is used</div><div class="line">      # like with kubeadm</div><div class="line">      hostNetwork: true</div><div class="line">      serviceAccountName: ingress</div><div class="line">      terminationGracePeriodSeconds: 60</div><div class="line">      containers:</div><div class="line">      - image: gcr.io/google_containers/nginx-ingress-controller:0.9.0-beta.5</div><div class="line">        name: nginx-ingress-controller</div><div class="line">        readinessProbe:</div><div class="line">          httpGet:</div><div class="line">            path: /healthz</div><div class="line">            port: 10254</div><div class="line">            scheme: HTTP</div><div class="line">        livenessProbe:</div><div class="line">          httpGet:</div><div class="line">            path: /healthz</div><div class="line">            port: 10254</div><div class="line">            scheme: HTTP</div><div class="line">          initialDelaySeconds: 10</div><div class="line">          timeoutSeconds: 1</div><div class="line">        ports:</div><div class="line">        - containerPort: 80</div><div class="line">          hostPort: 80</div><div class="line">        - containerPort: 443</div><div class="line">          hostPort: 443</div><div class="line">        env:</div><div class="line">          - name: POD_NAME</div><div class="line">            valueFrom:</div><div class="line">              fieldRef:</div><div class="line">                fieldPath: metadata.name</div><div class="line">          - name: POD_NAMESPACE</div><div class="line">            valueFrom:</div><div class="line">              fieldRef:</div><div class="line">                fieldPath: metadata.namespace</div><div class="line">        args:</div><div class="line">        - /nginx-ingress-controller</div><div class="line">        - --default-backend-service=$(POD_NAMESPACE)/default-http-backend</div></pre></td></tr></table></figure>
<p>成功后如下：</p>
<p><img src="http://img.blog.csdn.net/20170525171151583?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzgxMjcxMA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h4 id="test-service："><a href="#test-service：" class="headerlink" title="test service："></a>test service：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">apiVersion: extensions/v1beta1</div><div class="line">kind: Deployment</div><div class="line">metadata:</div><div class="line">  name: echoheaders</div><div class="line">spec:</div><div class="line">  replicas: 1</div><div class="line">  template:</div><div class="line">    metadata:</div><div class="line">      labels:</div><div class="line">        app: echoheaders</div><div class="line">    spec:</div><div class="line">      containers:</div><div class="line">      - name: echoheaders</div><div class="line">        image: gcr.io/google_containers/echoserver:1.0</div><div class="line">        ports:</div><div class="line">        - containerPort: 8080</div><div class="line"></div><div class="line">---</div><div class="line">apiVersion: v1</div><div class="line">kind: Service</div><div class="line">metadata:</div><div class="line">  name: echoheaders-default</div><div class="line">  labels:</div><div class="line">    app: echoheaders</div><div class="line">spec:</div><div class="line">  type: NodePort</div><div class="line">  ports:</div><div class="line">  - port: 80</div><div class="line">    nodePort: 30302</div><div class="line">    targetPort: 8080</div><div class="line">    protocol: TCP</div><div class="line">    name: http</div><div class="line">  selector:</div><div class="line">    app: echoheaders</div><div class="line"></div><div class="line">---</div><div class="line">apiVersion: v1</div><div class="line">kind: Service</div><div class="line">metadata:</div><div class="line">  name: echoheaders-default</div><div class="line">  labels:</div><div class="line">    app: echoheaders</div><div class="line">spec:</div><div class="line">  ports:</div><div class="line">  - port: 80</div><div class="line">    targetPort: 8080</div><div class="line">    protocol: TCP</div><div class="line">    name: http</div><div class="line">  selector:</div><div class="line">    app: echoheaders</div><div class="line"></div><div class="line">---</div><div class="line">apiVersion: v1</div><div class="line">kind: Service</div><div class="line">metadata:</div><div class="line">  name: echoheaders-x</div><div class="line">  labels:</div><div class="line">    app: echoheaders</div><div class="line">spec:</div><div class="line">  ports:</div><div class="line">  - port: 80</div><div class="line">    targetPort: 8080</div><div class="line">    protocol: TCP</div><div class="line">    name: http</div><div class="line">  selector:</div><div class="line">    app: echoheaders</div><div class="line"></div><div class="line">---</div><div class="line">apiVersion: v1</div><div class="line">kind: Service</div><div class="line">metadata:</div><div class="line">  name: echoheaders-y</div><div class="line">  labels:</div><div class="line">    app: echoheaders</div><div class="line">spec:</div><div class="line">  ports:</div><div class="line">  - port: 80</div><div class="line">    targetPort: 8080</div><div class="line">    protocol: TCP</div><div class="line">    name: http</div><div class="line">  selector:</div><div class="line">    app: echoheaders</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20170525172031313?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzgxMjcxMA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>####ingress:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">apiVersion: extensions/v1beta1</div><div class="line">kind: Ingress</div><div class="line">metadata:</div><div class="line">  name: echomap</div><div class="line">spec:</div><div class="line">  rules:</div><div class="line">  - host: foo.bar.com</div><div class="line">    http:</div><div class="line">      paths:</div><div class="line">      - path: /foo</div><div class="line">        backend:</div><div class="line">          serviceName: echoheaders-x</div><div class="line">          servicePort: 80</div><div class="line">  - host: bar.baz.com</div><div class="line">    http:</div><div class="line">      paths:</div><div class="line">      - path: /bar</div><div class="line">        backend:</div><div class="line">          serviceName: echoheaders-y</div><div class="line">          servicePort: 80</div><div class="line">      - path: /foo</div><div class="line">        backend:</div><div class="line">          serviceName: echoheaders-x</div><div class="line">          servicePort: 80</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20170525172012492?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzgxMjcxMA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h4 id="test："><a href="#test：" class="headerlink" title="test："></a>test：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -v http://10.39.1.45/foo -H &apos;host: foo.bar.com&apos;</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20170525171946765?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzgxMjcxMA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -v http://10.39.1.45/foo -H &apos;host: bar.baz.com&apos;</div></pre></td></tr></table></figure></p>
<p><img src="http://img.blog.csdn.net/20170525171936086?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzgxMjcxMA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -v http://10.39.1.45/bar -H &apos;host: bar.baz.com&apos;</div></pre></td></tr></table></figure></p>
<p><img src="http://img.blog.csdn.net/20170525171911601?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzgxMjcxMA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>说明：<br>10.39.1.45 是ingress的address，也就是ingress-controller所在的node的ip</p>
<p>结合ingress测试service的loadbalancer网络类型，之前一直没用过这种网络类型，更多的是用nodePort，所以想测试下<br>我的集群中已经存部署好了dashboard了所以就用dashboard来测试：</p>
<p>我新建一个lb类型的dashboard的service<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">kind: Service</div><div class="line">apiVersion: v1</div><div class="line">metadata:</div><div class="line">  labels:</div><div class="line">    k8s-app: kubernetes-dashboard-1</div><div class="line">  name: dashboard-1</div><div class="line">  namespace: kube-system</div><div class="line">spec:</div><div class="line">  type: LoadBalancer</div><div class="line">  loadBalancerIP: 10.39.1.44</div><div class="line">  ports:</div><div class="line">  - port: 8001</div><div class="line">    targetPort: 9090</div><div class="line">  selector:</div><div class="line">    k8s-app: kubernetes-dashboard</div></pre></td></tr></table></figure></p>
<p>10.39.1.44是我ingress-controller的ip（负载均衡器的ip）<br><img src="http://img.blog.csdn.net/20170525175717557?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzgxMjcxMA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p><img src="http://img.blog.csdn.net/20170525175733457?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzgxMjcxMA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>发现service的类型是LoadBalancer，但是确随机生成了NodePort：30617，之后我通过LoadBalancerip加NodePort能访问，我就猜测是否LoadBalancer类型，只能通过这个LoadBalancerIP去访问呢？ 但是由于有NodePort生成，所以我就尝试用其他node节点ip加NodePort访问，发现都是可以访问的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">kind: Ingress</div><div class="line">metadata:</div><div class="line">  name: test</div><div class="line">  namespace: kube-system</div><div class="line">spec:</div><div class="line">  rules:</div><div class="line">  - host: dashboard.io</div><div class="line">    http:</div><div class="line">      paths:</div><div class="line">      - path: /</div><div class="line">        backend:</div><div class="line">          serviceName: dashboard</div><div class="line">          servicePort: 80</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20170525175756760?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzgxMjcxMA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>总结：<br>1.之前一直以为loadbanlacer网络类型就是通过loadbalancerip来访问对应的应用，而测试之后发现service的loadbalancer网络类型通过ingress（或者说是nginx）实现，实质上就是nodePort类型<br>2.之前也一直以为ingress是这样的：通过ingress的yaml中的hosts／path就能直接访问到对应的service，事实是能访问到对应的service。但是，实际上需要你service中对应的pod中需要存在path的服务存在，否则会报404。 比如：一个web的应用，服务地址是：<a href="http://xxxx.xxx.xxx.xxx:8080/app" target="_blank" rel="external">http://xxxx.xxx.xxx.xxx:8080/app</a>, 发送请求的path就是／app，ingres.yaml中的path就定义为／app，如果你服务的地址是：<a href="http://xxxx.xxx.xxx.xxx:8080/apps，ingres.yaml中的path就定义为／app，那么就会报404" target="_blank" rel="external">http://xxxx.xxx.xxx.xxx:8080/apps，ingres.yaml中的path就定义为／app，那么就会报404</a>.</p>
</div></article></div><div class="right-container"><div class="widget"><div class="category"><h4>分类归档</h4><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/kubernetes/">kubernetes</a><span class="category-list-count">2</span></li></ul></div></div><div class="widget"><div class="tagcloud"><h4>标签云</h4><a href="/tags/kubernetes/" style="font-size: 10px;">kubernetes</a></div></div><div class="widget"><div class="recent"><h4>最近文章</h4><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/24/k8s-ingress/">kubernetes ingress部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/24/k8s-pod-status-md/">kubernetes pod状态分析</a></li></ul></div></div><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/2017/09/24/k8s-pod-status-md/" class="next">NEXT</a></div><!--PC和WAP自适应版--><div id="SOHUCS" sid="2017/09/24/k8s-ingress/"> </div><script>(function() {
    var appid = 'cyt6h19Ve'; 
    var conf = 'prod_0b4b95efa2ecfede2ddfb5adcef8c394'; 
    var width = window.innerWidth || document.documentElement.clientWidth; 
    if (width < 960) { 
    window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })();</script><div class="copyright"><p>© 2016 - 2017 <a target="_blank">Just Go</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a></p><p>闽ICP备16007301号-2</p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="http://apps.bdimg.com/libs/jquery/1.8.2/jquery.min.js"></script><script src="https://cdn1.lncld.net/static/js/av-mini-0.6.10.js"></script><script src="/scripts/hit-kounter-lc-0.2.0.js"></script><script src="/scripts/arAnchor.js"></script><script src="/scripts/main.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>