<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><meta name="google-site-verification" content="K7thEgdLm0UfRWJ5MGdF7sCcjClSzAlxFLPv2Oz5CGM"><title> kubernetes pod状态分析 · Just Go</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="kubernetes pod状态分析 - Just Go"><meta name="keywords"><meta name="author" content="Just Go"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Just Go"></head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="/images/logo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="博文" class="nav-list-link">博文</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/about/" target="_self" data-hover="关于" class="nav-list-link">关于</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">kubernetes pod状态分析</h1><div class="post-info">2017-09-24<p class="visit"><i data-hk-page="current">-</i><span>次访问</span></p></div><div class="post-content"><h2 id="k8s-pod-状态分析"><a href="#k8s-pod-状态分析" class="headerlink" title="k8s pod 状态分析"></a>k8s pod 状态分析</h2><p>pod从创建到最后的创建成功会分别处于不同的阶段，在源码中用PodPhase来表示不同的阶段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">PodPending PodPhase = &quot;Pending&quot;</div><div class="line">PodRunning PodPhase = &quot;Running&quot;</div><div class="line">PodSucceeded PodPhase = &quot;Succeeded&quot;</div><div class="line">PodFailed PodPhase = &quot;Failed&quot;</div><div class="line">PodUnknown PodPhase = &quot;Unknown&quot;</div></pre></td></tr></table></figure>
<p>一个pod的完整创建，通常会伴随着各种事件的产生，k8s种事件的种类总共只有4种：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Added    EventType = &quot;ADDED&quot;</div><div class="line">Modified EventType = &quot;MODIFIED&quot;</div><div class="line">Deleted  EventType = &quot;DELETED&quot;</div><div class="line">Error    EventType = &quot;ERROR&quot;</div></pre></td></tr></table></figure>
<ul>
<li>Pending 创建pod的请求已经被k8s接受，但是容器并没有启动成功，可能处在：写数据到etcd，调度，pull镜像，启动容器这四个阶段中的任何一个阶段，pending伴随的事件通常会有：ADDED, Modified这两个事件的产生。</li>
<li>Running pod已经绑定到node节点，并且所有的容器已经启动成功，或者至少有一个容器在运行，或者在重启中。</li>
<li>Succeeded pod中的所有的容器已经正常的自行退出，并且k8s永远不会自动重启这些容器，一般会是在部署job的时候会出现。</li>
<li>Failed pod中的所有容器已经终止，并且至少有一个容器已经终止于失败（退出非零退出代码或被系统停止）。</li>
<li>Unknown 由于某种原因，无法获得pod的状态，通常是由于与pod的主机通信错误。</li>
</ul>
<p>以上说到的pod的状态是粗略的状态，还有更佳详细的状态信息，在源码中表示如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">PodScheduled PodConditionType = &quot;PodScheduled&quot;</div><div class="line">PodReady PodConditionType = &quot;Ready&quot;</div><div class="line">PodInitialized PodConditionType = &quot;Initialized&quot;</div><div class="line">PodReasonUnschedulable = &quot;Unschedulable&quot;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">type PodCondition struct &#123;</div><div class="line">  Type PodConditionType `json:&quot;type&quot; protobuf:&quot;bytes,1,opt,name=type,casttype=PodConditionType&quot;`</div><div class="line">  Status ConditionStatus `json:&quot;status&quot; protobuf:&quot;bytes,2,opt,name=status,casttype=ConditionStatus&quot;`</div><div class="line">  LastProbeTime metav1.Time `json:&quot;lastProbeTime,omitempty&quot; protobuf:&quot;bytes,3,opt,name=lastProbeTime&quot;`</div><div class="line">  LastTransitionTime metav1.Time `json:&quot;lastTransitionTime,omitempty&quot; protobuf:&quot;bytes,4,opt,name=lastTransitionTime&quot;`</div><div class="line">  Reason string `json:&quot;reason,omitempty&quot; protobuf:&quot;bytes,5,opt,name=reason&quot;`</div><div class="line">  Message string `json:&quot;message,omitempty&quot; protobuf:&quot;bytes,6,opt,name=message&quot;`</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>PodScheduled pod正处于调度中，刚开始调度的时候，hostip还没绑定上，持续调度之后，有合适的节点就会绑定hostip，然后更新etcd数据</li>
<li>Initialized pod中的所有初始化容器已经初启动完毕</li>
<li>Ready pod中的容器可以提供服务了</li>
<li>Unschedulable 不能调度，没有合适的节点</li>
</ul>
<p>PodCondition中的ConditionStatus，它代表了当前pod是否处于某一个阶段（PodScheduled，Ready，Initialized，Unschedulable），“true” 表示处于，“false”表示不处于</p>
<p>以下通过创建一个pod来具体的看看从pod创建到成功所触发的事件，以及pod相关状态的改变</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl apply -f busybox.yaml</div></pre></td></tr></table></figure>
<p>第一步：写入数据到etcd</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">event type: ADDED </div><div class="line">event object: </div><div class="line">&#123;</div><div class="line">    &quot;phase&quot;: &quot;Pending&quot;,</div><div class="line">    &quot;qosClass&quot;: &quot;BestEffort&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>第二步：开始被调度，但是还未调度到具体node上，请注意：PodScheduled的status=“true”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">event type: MODIFIED</div><div class="line">&#123;</div><div class="line">  &quot;phase&quot;: &quot;Pending&quot;,</div><div class="line">  &quot;conditions&quot;: [</div><div class="line">    &#123;</div><div class="line">      &quot;type&quot;: &quot;PodScheduled&quot;,</div><div class="line">      &quot;status&quot;: &quot;True&quot;,</div><div class="line">      &quot;lastProbeTime&quot;: null,</div><div class="line">      &quot;lastTransitionTime&quot;: &quot;2017-06-06T07:57:06Z&quot;</div><div class="line">    &#125;</div><div class="line">  ],</div><div class="line">  &quot;qosClass&quot;: &quot;BestEffort&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>第三步：被调度到了具体的node上hostip绑定了，并且被所有初始化容器已经启动完毕（注意我的busybox.yaml中pod没有指定init container，所以这里很快就被设置成true）,被调度到的节点watch到并开始创建容器（此阶段是在拉去镜像）然后创建容器 ，而此时Ready的status是false，仔细看会发现，containerStatus的状态未waiting</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">event type: MODIFIED</div><div class="line">&#123;</div><div class="line">  &quot;phase&quot;: &quot;Pending&quot;,</div><div class="line">  &quot;conditions&quot;: [</div><div class="line">    &#123;</div><div class="line">      &quot;type&quot;: &quot;Initialized&quot;,</div><div class="line">      &quot;status&quot;: &quot;True&quot;,</div><div class="line">      &quot;lastProbeTime&quot;: null,</div><div class="line">      &quot;lastTransitionTime&quot;: &quot;2017-06-06T07:57:06Z&quot;</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">      &quot;type&quot;: &quot;Ready&quot;,</div><div class="line">      &quot;status&quot;: &quot;False&quot;,</div><div class="line">      &quot;lastProbeTime&quot;: null,</div><div class="line">      &quot;lastTransitionTime&quot;: &quot;2017-06-06T07:57:06Z&quot;,</div><div class="line">      &quot;reason&quot;: &quot;ContainersNotReady&quot;,</div><div class="line">      &quot;message&quot;: &quot;containers with unready status: [busybox]&quot;</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">      &quot;type&quot;: &quot;PodScheduled&quot;,</div><div class="line">      &quot;status&quot;: &quot;True&quot;,</div><div class="line">      &quot;lastProbeTime&quot;: null,</div><div class="line">      &quot;lastTransitionTime&quot;: &quot;2017-06-06T07:57:06Z&quot;</div><div class="line">    &#125;</div><div class="line">  ],</div><div class="line">  &quot;hostIP&quot;: &quot;10.39.1.35&quot;,</div><div class="line">  &quot;startTime&quot;: &quot;2017-06-06T07:57:06Z&quot;,</div><div class="line">  &quot;containerStatuses&quot;: [</div><div class="line">    &#123;</div><div class="line">      &quot;name&quot;: &quot;busybox&quot;,</div><div class="line">      &quot;state&quot;: &#123;</div><div class="line">        &quot;waiting&quot;: &#123;</div><div class="line">          &quot;reason&quot;: &quot;ContainerCreating&quot;</div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">      &quot;lastState&quot;: &#123;&#125;,</div><div class="line">      &quot;ready&quot;: false,</div><div class="line">      &quot;restartCount&quot;: 0,</div><div class="line">      &quot;image&quot;: &quot;busybox&quot;,</div><div class="line">      &quot;imageID&quot;: &quot;&quot;</div><div class="line">    &#125;</div><div class="line">  ],</div><div class="line">  &quot;qosClass&quot;: &quot;BestEffort&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>第四步：容器创建成功，Ready的status=“true”，此时容器的status也为running，这个时候，对应的pod的PodPhase也应该为running</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">event type: MODIFIED</div><div class="line">&#123;</div><div class="line">  &quot;phase&quot;: &quot;Running&quot;,</div><div class="line">  &quot;conditions&quot;: [</div><div class="line">    &#123;</div><div class="line">      &quot;type&quot;: &quot;Initialized&quot;,</div><div class="line">      &quot;status&quot;: &quot;True&quot;,</div><div class="line">      &quot;lastProbeTime&quot;: null,</div><div class="line">      &quot;lastTransitionTime&quot;: &quot;2017-06-06T07:57:06Z&quot;</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">      &quot;type&quot;: &quot;Ready&quot;,</div><div class="line">      &quot;status&quot;: &quot;True&quot;,</div><div class="line">      &quot;lastProbeTime&quot;: null,</div><div class="line">      &quot;lastTransitionTime&quot;: &quot;2017-06-06T07:57:08Z&quot;</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">      &quot;type&quot;: &quot;PodScheduled&quot;,</div><div class="line">      &quot;status&quot;: &quot;True&quot;,</div><div class="line">      &quot;lastProbeTime&quot;: null,</div><div class="line">      &quot;lastTransitionTime&quot;: &quot;2017-06-06T07:57:06Z&quot;</div><div class="line">    &#125;</div><div class="line">  ],</div><div class="line">  &quot;hostIP&quot;: &quot;10.39.1.35&quot;,</div><div class="line">  &quot;podIP&quot;: &quot;192.168.107.204&quot;,</div><div class="line">  &quot;startTime&quot;: &quot;2017-06-06T07:57:06Z&quot;,</div><div class="line">  &quot;containerStatuses&quot;: [</div><div class="line">    &#123;</div><div class="line">      &quot;name&quot;: &quot;busybox&quot;,</div><div class="line">      &quot;state&quot;: &#123;</div><div class="line">        &quot;running&quot;: &#123;</div><div class="line">          &quot;startedAt&quot;: &quot;2017-06-06T07:57:08Z&quot;</div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">      &quot;lastState&quot;: &#123;&#125;,</div><div class="line">      &quot;ready&quot;: true,</div><div class="line">      &quot;restartCount&quot;: 0,</div><div class="line">      &quot;image&quot;: &quot;busybox:latest&quot;,</div><div class="line">      &quot;imageID&quot;: &quot;docker-pullable://busybox@sha256:c79345819a6882c31b41bc771d9a94fc52872fa651b36771fbe0c8461d7ee558&quot;,</div><div class="line">      &quot;containerID&quot;: &quot;docker://a6af9d58c7dabf55fdfe8d4222b2c16349e3b49b3d0eca4bc761fdb571f3cf44&quot;</div><div class="line">    &#125;</div><div class="line">  ],</div><div class="line">  &quot;qosClass&quot;: &quot;BestEffort&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</div></article></div><div class="right-container"><div class="widget"><div class="category"><h4>分类归档</h4><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/kubernetes/">kubernetes</a><span class="category-list-count">3</span></li></ul></div></div><div class="widget"><div class="tagcloud"><h4>标签云</h4><a href="/tags/kubernetes/" style="font-size: 20px;">kubernetes</a> <a href="/tags/kubernetes-golang/" style="font-size: 10px;">kubernetes golang</a></div></div><div class="widget"><div class="recent"><h4>最近文章</h4><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/24/kubernetes-client-go-introduce-md/">kubernetes client-go介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/24/k8s-pod-status-md/">kubernetes pod状态分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/24/k8s-ingress/">kubernetes ingress部署</a></li></ul></div></div><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/2017/09/24/kubernetes-client-go-introduce-md/" class="prev">PREV</a><a href="/2017/09/24/k8s-ingress/" class="next">NEXT</a></div><!--PC和WAP自适应版--><div id="SOHUCS" sid="2017/09/24/k8s-pod-status-md/"> </div><script>(function() {
    var appid = 'cyt6h19Ve'; 
    var conf = 'prod_0b4b95efa2ecfede2ddfb5adcef8c394'; 
    var width = window.innerWidth || document.documentElement.clientWidth; 
    if (width < 960) { 
    window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })();</script><div class="copyright"><p>© 2016 - 2017 <a target="_blank">Just Go</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a></p><p>闽ICP备16007301号-2</p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="http://apps.bdimg.com/libs/jquery/1.8.2/jquery.min.js"></script><script src="https://cdn1.lncld.net/static/js/av-mini-0.6.10.js"></script><script src="/scripts/hit-kounter-lc-0.2.0.js"></script><script src="/scripts/arAnchor.js"></script><script src="/scripts/main.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>